{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/gh-tui-tools/gh-activity-chronicle/schema.json",
  "title": "gh-activity-chronicle JSON output",
  "description": "Machine-readable output from gh-activity-chronicle, containing metadata, raw gathered data, and computed report sections.",
  "type": "object",
  "required": ["meta", "data", "report"],
  "additionalProperties": false,
  "properties": {
    "meta": {
      "description": "Report metadata â€” tool info, date range, and subject (user or org).",
      "oneOf": [
        { "$ref": "#/$defs/userMeta" },
        { "$ref": "#/$defs/orgMeta" }
      ]
    },
    "data": { "$ref": "#/$defs/data" },
    "report": { "$ref": "#/$defs/report" }
  },

  "$defs": {

    "userMeta": {
      "description": "Metadata for a single-user report.",
      "type": "object",
      "required": ["tool", "version", "generated_at", "username", "since_date", "until_date"],
      "additionalProperties": false,
      "properties": {
        "tool":         { "type": "string", "const": "gh-activity-chronicle" },
        "version":      { "type": "string", "examples": ["1.0.0"] },
        "generated_at": { "$ref": "#/$defs/isoDatetime" },
        "username":     { "type": "string", "description": "GitHub username." },
        "since_date":   { "$ref": "#/$defs/dateString" },
        "until_date":   { "$ref": "#/$defs/dateString" }
      }
    },

    "orgMeta": {
      "description": "Metadata for an organization report.",
      "type": "object",
      "required": ["tool", "version", "generated_at", "org", "team", "since_date", "until_date", "members"],
      "additionalProperties": false,
      "properties": {
        "tool":         { "type": "string", "const": "gh-activity-chronicle" },
        "version":      { "type": "string", "examples": ["1.0.0"] },
        "generated_at": { "$ref": "#/$defs/isoDatetime" },
        "org":          { "$ref": "#/$defs/orgInfo" },
        "team":         {
          "oneOf": [
            { "$ref": "#/$defs/teamInfo" },
            { "type": "null" }
          ],
          "description": "Team info when --team is used, otherwise null."
        },
        "since_date":   { "$ref": "#/$defs/dateString" },
        "until_date":   { "$ref": "#/$defs/dateString" },
        "members":      {
          "type": "array",
          "items": { "type": "string" },
          "description": "GitHub usernames of all members included in the report."
        }
      }
    },

    "orgInfo": {
      "type": "object",
      "required": ["login", "name", "description"],
      "additionalProperties": false,
      "properties": {
        "login":       { "type": "string", "description": "GitHub org login (e.g. \"w3c\")." },
        "name":        { "type": "string", "description": "Display name (e.g. \"World Wide Web Consortium\")." },
        "description": { "type": "string", "description": "GitHub org description." }
      }
    },

    "teamInfo": {
      "type": "object",
      "required": ["slug", "name", "description"],
      "additionalProperties": false,
      "properties": {
        "slug":        { "type": "string", "description": "Team URL slug." },
        "name":        { "type": "string", "description": "Team display name." },
        "description": { "type": "string", "description": "Team description." }
      }
    },

    "data": {
      "description": "Raw gathered data passed through from gather_user_data() or aggregate_org_data(). This is an internal implementation detail; the schema documents key fields without being exhaustive.",
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "total_commits_default_branch": { "type": "integer" },
        "total_commits_all":            { "type": "integer" },
        "total_prs":                    { "type": "integer" },
        "total_pr_reviews":             { "type": "integer" },
        "total_issues":                 { "type": "integer" },
        "repos_contributed":            { "type": "integer" },
        "total_additions":              { "type": "integer" },
        "total_deletions":              { "type": "integer" },
        "reviews_received":             { "type": "integer" },
        "pr_comments_received":         { "type": "integer" },
        "lines_reviewed":               { "type": "integer" },
        "review_comments":              { "type": "integer" },
        "test_commits":                 { "type": "integer" },
        "prs_nodes":                    { "type": "array", "items": { "type": "object" } },
        "reviewed_nodes":               { "type": "array", "items": { "type": "object" } },
        "repos_by_category": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "$ref": "#/$defs/rawRepoEntry" }
          }
        },
        "repo_line_stats": {
          "type": "object",
          "additionalProperties": { "$ref": "#/$defs/lineStats" }
        },
        "repo_languages": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "repo_member_commits":  { "$ref": "#/$defs/memberCommitMap" },
        "lang_member_commits":  { "$ref": "#/$defs/memberCommitMap" },
        "member_real_names":    { "$ref": "#/$defs/stringMap" },
        "member_companies":     { "$ref": "#/$defs/stringMap" },
        "is_light_mode":        { "type": "boolean" },
        "owners_only":          { "type": "boolean" }
      }
    },

    "report": {
      "description": "Computed report sections. Both user and org modes share the same base keys; org mode adds four additional keys for member breakdowns.",
      "type": "object",
      "required": [
        "executive_summary",
        "notable_prs",
        "projects_by_category",
        "languages",
        "prs_reviewed",
        "prs_created",
        "reviews_received"
      ],
      "additionalProperties": false,
      "properties": {
        "executive_summary":    { "$ref": "#/$defs/executiveSummary" },
        "notable_prs":          {
          "type": "array",
          "items": { "$ref": "#/$defs/notablePr" },
          "description": "Top 10 PRs by total lines changed (additions + deletions)."
        },
        "projects_by_category": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "$ref": "#/$defs/reportRepoEntry" }
          },
          "description": "Repositories grouped by category name."
        },
        "languages":            {
          "type": "array",
          "items": { "$ref": "#/$defs/languageStat" },
          "description": "Aggregate statistics per programming language, sorted by commit count descending."
        },
        "prs_reviewed":         {
          "type": "array",
          "items": { "$ref": "#/$defs/repoReviewEntry" },
          "description": "Top 15 repositories by number of PRs reviewed."
        },
        "prs_created":          { "$ref": "#/$defs/prsCreated" },
        "reviews_received":     { "$ref": "#/$defs/reviewsReceived" },
        "repo_member_commits":  { "$ref": "#/$defs/memberCommitMap" },
        "lang_member_commits":  { "$ref": "#/$defs/memberCommitMap" },
        "member_real_names":    { "$ref": "#/$defs/stringMap" },
        "member_companies":     { "$ref": "#/$defs/stringMap" }
      }
    },

    "executiveSummary": {
      "description": "Key metrics. User mode includes line stats; org light mode omits them.",
      "type": "object",
      "required": [
        "commits_default_branch",
        "commits_all_branches",
        "prs_created",
        "pr_reviews_given",
        "issues_created",
        "repositories_contributed_to"
      ],
      "additionalProperties": false,
      "properties": {
        "commits_default_branch":     { "type": "integer" },
        "commits_all_branches":       { "type": "integer" },
        "prs_created":                { "type": "integer" },
        "pr_reviews_given":           { "type": "integer" },
        "issues_created":             { "type": "integer" },
        "repositories_contributed_to": { "type": "integer" },
        "lines_added":                { "type": "integer", "description": "Present in user mode; absent in org light mode." },
        "lines_deleted":              { "type": "integer", "description": "Present in user mode; absent in org light mode." },
        "test_related_commits":       { "type": "integer", "description": "Present in user mode; absent in org light mode." }
      }
    },

    "notablePr": {
      "type": "object",
      "required": ["title", "url", "state", "additions", "deletions", "repository", "language"],
      "additionalProperties": false,
      "properties": {
        "title":      { "type": "string" },
        "url":        { "type": "string", "format": "uri" },
        "state":      { "type": "string", "enum": ["OPEN", "MERGED", "CLOSED"] },
        "additions":  { "type": "integer", "minimum": 0 },
        "deletions":  { "type": "integer", "minimum": 0 },
        "repository": { "type": "string", "description": "owner/repo format." },
        "language":   { "type": "string", "description": "Primary language of the repository (may be empty)." }
      }
    },

    "reportRepoEntry": {
      "description": "Repository entry in the projects-by-category section. User mode always includes additions/deletions; org light mode omits them.",
      "type": "object",
      "required": ["name", "commits", "language", "description"],
      "additionalProperties": false,
      "properties": {
        "name":        { "type": "string", "description": "owner/repo format." },
        "commits":     { "type": "integer", "minimum": 0 },
        "language":    { "type": "string" },
        "description": { "type": "string" },
        "additions":   { "type": "integer", "minimum": 0, "description": "Present in user mode; absent in org light mode." },
        "deletions":   { "type": "integer", "minimum": 0, "description": "Present in user mode; absent in org light mode." }
      }
    },

    "languageStat": {
      "description": "Aggregate stats for one programming language. User mode includes additions/deletions; org light mode omits them.",
      "type": "object",
      "required": ["language", "commits", "repos"],
      "additionalProperties": false,
      "properties": {
        "language":   { "type": "string" },
        "commits":    { "type": "integer", "minimum": 0 },
        "repos":      { "type": "integer", "minimum": 0, "description": "Number of repositories using this language." },
        "additions":  { "type": "integer", "minimum": 0, "description": "Present in user mode; absent in org light mode." },
        "deletions":  { "type": "integer", "minimum": 0, "description": "Present in user mode; absent in org light mode." }
      }
    },

    "repoReviewEntry": {
      "type": "object",
      "required": ["repository", "language", "prs_reviewed", "total_lines"],
      "additionalProperties": false,
      "properties": {
        "repository":   { "type": "string", "description": "owner/repo format." },
        "language":     { "type": "string" },
        "prs_reviewed": { "type": "integer", "minimum": 0 },
        "total_lines":  { "type": "integer", "minimum": 0, "description": "Sum of additions + deletions across all reviewed PRs." }
      }
    },

    "prsCreated": {
      "type": "object",
      "required": ["merged", "open", "closed_not_merged", "total"],
      "additionalProperties": false,
      "properties": {
        "merged":           { "type": "integer", "minimum": 0 },
        "open":             { "type": "integer", "minimum": 0 },
        "closed_not_merged": { "type": "integer", "minimum": 0 },
        "total":            { "type": "integer", "minimum": 0 }
      }
    },

    "reviewsReceived": {
      "type": "object",
      "required": ["reviews_received", "review_comments_received"],
      "additionalProperties": false,
      "properties": {
        "reviews_received":         { "type": "integer", "minimum": 0 },
        "review_comments_received": { "type": "integer", "minimum": 0 }
      }
    },

    "rawRepoEntry": {
      "description": "Repository entry in the raw data repos_by_category dict.",
      "type": "object",
      "required": ["name", "commits", "description", "language"],
      "properties": {
        "name":        { "type": "string" },
        "commits":     { "type": "integer" },
        "description": { "type": ["string", "null"] },
        "language":    { "type": "string" }
      }
    },

    "lineStats": {
      "type": "object",
      "required": ["additions", "deletions"],
      "additionalProperties": false,
      "properties": {
        "additions": { "type": "integer", "minimum": 0 },
        "deletions": { "type": "integer", "minimum": 0 }
      }
    },

    "memberCommitMap": {
      "description": "Maps a key (repo name or language) to an object of { username: commit_count }.",
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": { "type": "integer", "minimum": 0 }
      }
    },

    "stringMap": {
      "description": "Maps GitHub usernames to string values (real names or company names).",
      "type": "object",
      "additionalProperties": { "type": "string" }
    },

    "isoDatetime": {
      "type": "string",
      "description": "ISO 8601 datetime with timezone offset (e.g. \"2026-01-30T10:52:10.989590+09:00\").",
      "examples": ["2026-01-30T10:52:10.989590+09:00"]
    },

    "dateString": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Date in YYYY-MM-DD format.",
      "examples": ["2026-01-01"]
    }
  }
}
